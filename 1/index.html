<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1: Images of the Russian Empire</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Project 1: Images of the Russian Empire</h1>
            <p class="subtitle">Colorizing the Prokudin-Gorskii photo collection</p>
            <p class="subtitle">Due: September 12, 2025 • CS180</p>
        </header>
        
        <div style="padding: 20px;">
            <a href="../index.html">← Back to Portfolio</a>
        </div>

        <main>
            <!-- Overview Section -->
            <div class="project-content">
                <h2>Overview</h2>
                <div class="project-content-body">
                    <p>This project involved taking digitized Prokudin-Gorskii glass plate images and automatically producing color images by extracting three color channels (Blue, Green, Red) and aligning them to form a single RGB color image. The main challenge was developing an efficient alignment algorithm that could handle both small JPEG files and large TIFF files.</p>

                    <h3>Approach</h3>
                    <p>[Describe your overall approach to the problem. What was your strategy for splitting the images into three channels? How did you decide which channel to use as the reference?]</p>

                    <h3>Implementation Details</h3>
                    <p><strong>Single-Scale Implementation:</strong> [Describe your basic implementation. What search window did you use for small images? What similarity metric did you choose and why? How did you handle the image splitting?]</p>
                    
                    <p><strong>Multi-Scale Pyramid:</strong> [Explain how you implemented the image pyramid for large TIFF files. How many pyramid levels did you use? How did you handle the coarse-to-fine refinement? What downsampling technique did you use?]</p>

                    <p><strong>Similarity Metrics:</strong> [Discuss which metrics you tried. Did you use L2 norm, Normalized Cross-Correlation, or something else? Why did you choose your final metric?]</p>
                </div>
            </div>

            <!-- Results Section -->
            <div class="project-content">
                <h2>Results on Example Images</h2>
                <div class="project-content-body">
                    <p>Below are the results of my alignment algorithm on the provided example images. The displacement vectors show the (x,y) offsets used to align the Green and Red channels to the Blue channel.</p>

                    <!-- Low-res JPEG Images -->
                    <h3>Low-Resolution Images (.jpg)</h3>
                    <div id="jpeg-results"></div>

                    <!-- High-res TIFF Images -->
                    <h3>High-Resolution Images (.tif)</h3>
                    <div id="tiff-results"></div>

                    <!-- Complete Alignment Results Table -->
                    <h3>Complete Alignment Results</h3>
                    <div style="overflow-x: auto;">
                        <table id="results-table" style="margin: 20px auto; border-collapse: collapse; border: 1px solid #ddd; min-width: 600px;">
                            <thead style="background-color: #f2f2f2;">
                                <tr>
                                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Image</th>
                                    <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">Green Offset (x, y)</th>
                                    <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">Red Offset (x, y)</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!-- Results will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Additional Images Section -->
            <div class="project-content">
                <h2>Additional Images from the Prokudin-Gorskii Collection</h2>
                <div class="project-content-body">
                    <p>I selected a few additional images from the Prokudin-Gorskii collection to test my algorithm on different types of scenes and content.</p>

                    <h3>Image 1: [Your chosen image name]</h3>
                    <div class="image-gallery">
                        <div class="image-container">
                            <img src="./my_images/[your_image1].jpg" alt="My chosen image 1">
                            <div class="image-caption">
                                [Description of what this image shows]<br>
                                Green offset: [your values]<br>
                                Red offset: [your values]
                            </div>
                        </div>
                    </div>
                    <p><strong>Why I chose this image:</strong> [Explain what was interesting about this particular image - was it challenging? Did it have unique features? How did your algorithm perform?]</p>

                    <h3>Image 2: [Your chosen image name]</h3>
                    <div class="image-gallery">
                        <div class="image-container">
                            <img src="./my_images/[your_image2].jpg" alt="My chosen image 2">
                            <div class="image-caption">
                                [Description of what this image shows]<br>
                                Green offset: [your values]<br>
                                Red offset: [your values]
                            </div>
                        </div>
                    </div>
                    <p><strong>Why I chose this image:</strong> [Explain the rationale for selecting this image]</p>

                    <h3>Image 3: [Your chosen image name]</h3>
                    <div class="image-gallery">
                        <div class="image-container">
                            <img src="./my_images/[your_image3].jpg" alt="My chosen image 3">
                            <div class="image-caption">
                                [Description of what this image shows]<br>
                                Green offset: [your values]<br>
                                Red offset: [your values]
                            </div>
                        </div>
                    </div>
                    <p><strong>Why I chose this image:</strong> [Explain what made this image interesting to process]</p>
                </div>
            </div>

            <!-- Analysis and Challenges Section -->
            <div class="project-content">
                <h2>Analysis and Challenges</h2>
                <div class="project-content-body">
                    <h3>What Worked Well</h3>
                    <p>[Discuss which images aligned successfully and why. What patterns did you notice in the successful alignments?]</p>

                    <h3>Challenging Images</h3>
                    <p>[If any images failed to align properly, explain why. For example, the Emir image is known to be challenging due to different brightness values across channels. How did you handle such cases?]</p>

                    <h3>Algorithm Performance</h3>
                    <p>[Discuss the runtime of your algorithm. How long did it take to process the large TIFF files? How did the pyramid approach help with efficiency?]</p>

                    <h3>Parameter Tuning</h3>
                    <p>[Describe what parameters you had to tune. Search window sizes, pyramid levels, similarity thresholds, etc. Did you use the same parameters for all images?]</p>
                </div>
            </div>

            <!-- Technical Implementation Section -->
            <div class="project-content">
                <h2>Technical Implementation</h2>
                <div class="project-content-body">
                    <h3>Code Structure</h3>
                    <p>[Describe your code organization. What were the main functions? How did you structure the pyramid implementation?]</p>

                    <h3>Key Algorithms</h3>
                    <p><strong>Image Splitting:</strong> [How did you divide the glass plate into three equal parts?]</p>
                    <p><strong>Alignment Search:</strong> [Describe your search strategy and optimization techniques]</p>
                    <p><strong>Pyramid Construction:</strong> [How did you build and navigate the image pyramid?]</p>

                    <h3>Optimizations</h3>
                    <p>[What techniques did you use to speed up your code? Vectorization, avoiding loops, efficient data structures, etc.]</p>
                </div>
            </div>

            <!-- Reflection Section -->
            <div class="project-content">
                <h2>Reflection</h2>
                <div class="project-content-body">
                    <h3>What I Learned</h3>
                    <p>[Discuss what you learned about image alignment, computer vision, and the historical significance of the Prokudin-Gorskii collection]</p>

                    <h3>Future Improvements</h3>
                    <p>[What would you do differently if you were to implement this again? What bells and whistles would you add?]</p>

                    <h3>Historical Perspective</h3>
                    <p>[Reflect on the historical significance of bringing these century-old photographs to life with modern computational techniques]</p>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 CS180 Portfolio • Sylvie Venuto • UC Berkeley</p>
        </footer>
    </div>

    <script>
        // Function to load and parse CSV data
        async function loadAlignmentResults() {
            try {
                const response = await fetch('./alignment_results.csv');
                const csvText = await response.text();
                
                // Simple CSV parser
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                const results = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',');
                    const result = {};
                    headers.forEach((header, index) => {
                        result[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    results.push(result);
                }
                
                return results;
            } catch (error) {
                console.error('Error loading CSV:', error);
                return [];
            }
        }

        // Function to create image display section
        function createImageSection(imageName, greenOffset, redOffset) {
            const baseImageName = imageName.replace('.tif', '').replace('.jpg', '');
            
            return `
                <h4>${imageName}</h4>
                <div class="image-gallery">
                    <div class="image-container">
                        <img src="./aligned_images/${baseImageName}.jpg" alt="Aligned ${baseImageName} image">
                        <div class="image-caption">
                            Aligned Result<br>
                            Green offset: (${greenOffset})<br>
                            Red offset: (${redOffset})
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to load images from my_images_aligned folder
        async function loadMyImages() {
            // Try to load any .jpg files in the my_images_aligned folder
            const possibleNames = [
                'church', 'cathedral', 'monastery', 'chapel', 'temple',
                'lilacs', 'flowers', 'blossoms', 'garden', 'bloom',
                'river', 'water', 'stream', 'lake', 'pond',
                'forest', 'woods', 'trees', 'path', 'trail',
                'village', 'house', 'building', 'landscape'
            ];
            
            const possibleImages = [];
            // Try each name with .jpg extension
            for (const name of possibleNames) {
                possibleImages.push(`${name}.jpg`);
            }
            
            const foundImages = [];
            
            // Try to load each possible image
            for (const imageName of possibleImages) {
                try {
                    const img = new Image();
                    const imageUrl = `./my_images_aligned/${imageName}`;
                    
                    await new Promise((resolve, reject) => {
                        img.onload = () => resolve(img);
                        img.onerror = () => reject();
                        img.src = imageUrl;
                    });
                    
                    foundImages.push(imageName);
                } catch (error) {
                    // Image doesn't exist, skip it
                }
            }
            
            return foundImages;
        }

        // Function to create additional image section
        function createMyImageSection(imageName) {
            const baseImageName = imageName.replace('.jpg', '');
            
            return `
                <h3>${baseImageName}</h3>
                <div class="image-gallery">
                    <div class="image-container">
                        <img src="./my_images_aligned/${imageName}" alt="Additional image: ${baseImageName}">
                        <div class="image-caption">
                            Aligned Result
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to create additional image section
        function createMyImageSection(imageName) {
            const baseImageName = imageName.replace('.jpg', '');
            
            return `
                <h3>${baseImageName}</h3>
                <div class="image-gallery">
                    <div class="image-container">
                        <img src="./my_images/${imageName}" alt="Additional image: ${baseImageName}">
                        <div class="image-caption">
                            Aligned Result
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to populate results
        async function populateResults() {
            const results = await loadAlignmentResults();
            
            if (results.length === 0) {
                console.error('No results loaded');
                return;
            }

            const jpegContainer = document.getElementById('jpeg-results');
            const tiffContainer = document.getElementById('tiff-results');
            const tableBody = document.getElementById('table-body');
            
            let jpegHtml = '';
            let tiffHtml = '';
            let tableHtml = '';

            results.forEach(result => {
                const imageName = result.image_name;
                const greenOffset = `${result.best_w_g}, ${result.best_h_g}`;
                const redOffset = `${result.best_w_r}, ${result.best_h_r}`;
                
                // Create image section
                const imageSection = createImageSection(imageName, greenOffset, redOffset);
                
                // Separate by file type
                if (imageName.endsWith('.jpg')) {
                    jpegHtml += imageSection;
                } else if (imageName.endsWith('.tif')) {
                    tiffHtml += imageSection;
                }
                
                // Add to table
                tableHtml += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px;">${imageName}</td>
                        <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">(${greenOffset})</td>
                        <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">(${redOffset})</td>
                    </tr>
                `;
            });

            // Populate the sections
            jpegContainer.innerHTML = jpegHtml;
            tiffContainer.innerHTML = tiffHtml;
            tableBody.innerHTML = tableHtml;
            
            // Load and populate additional images
            const myImages = await loadMyImages();
            const myImagesContainer = document.getElementById('my-images-container');
            
            if (myImages.length > 0) {
                let myImagesHtml = '';
                myImages.forEach(imageName => {
                    myImagesHtml += createMyImageSection(imageName);
                });
                myImagesContainer.innerHTML = myImagesHtml;
            } else {
                myImagesContainer.innerHTML = '<p>No additional images found in my_images folder.</p>';
            }
        }

        // Load results when page loads
        document.addEventListener('DOMContentLoaded', populateResults);
    </script>
</body>
</html>
